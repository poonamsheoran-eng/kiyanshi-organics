<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kiyanshi Organics | Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container d-flex justify-content-center align-items-center vh-100">
  <div class="card p-4 shadow" style="width: 350px;">
    
    <div class="text-center mb-3">
      <div class="rounded-circle bg-warning text-white d-inline-flex align-items-center justify-content-center"
           style="width:60px;height:60px;font-size:28px;">
        ðŸ›’
      </div>
      <h4 class="mt-3">Kiyanshi Organics</h4>
      <p class="text-muted">Sign in to your account</p>
    </div>
    
    <div class="mb-3">
      <label class="form-label">Mobile Number</label>
      <input type="text" id="mobile" class="form-control" placeholder="Enter 10-digit mobile">
    </div>
    
    <div class="mb-3">
      <label class="form-label">Password</label>
      <input type="password" id="password" class="form-control" placeholder="Enter password">
    </div>
    
    <div class="d-flex justify-content-between mb-3">
      <div>
        <input type="checkbox" id="rememberMe"> Remember me
      </div>
      <a href="#" class="text-warning text-decoration-none">Forgot password?</a>
    </div>
    
    <button
      type="button"
      class="btn btn-warning w-100 fw-bold"
      onclick="authUser()"
      style="color:#ffffff !important;"
    >
      Continue
    </button>
    
    <p id="message" class="text-center mt-2"></p>
  </div>
</div>

<script>
// ========== CONFIG ==========
const API_URL = '/api';

async function authUser() {
  const mobile = document.getElementById("mobile").value.trim();
  const password = document.getElementById("password").value.trim();
  const rememberMe = document.getElementById("rememberMe").checked;
  const messageEl = document.getElementById("message");
  
  messageEl.innerText = "";
  messageEl.className = "text-center mt-2";
  
  if (!mobile || !password) {
    messageEl.innerText = "Mobile number and password are required";
    messageEl.classList.add("text-danger");
    return;
  }
  
  try {
    const res = await fetch(`${API_URL}/auth`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ mobile, password })
    });
    
    const data = await res.json();
    
    if (!res.ok) {
      throw new Error(data.error || data.message || "Login failed");
    }
    
    // Save session
    if (rememberMe) {
      localStorage.setItem("mobile", mobile);
    } else {
      sessionStorage.setItem("mobile", mobile);
    }
    sessionStorage.setItem("role", data.role);
    
    messageEl.innerText = data.message;
    messageEl.classList.add("text-success");
    
    setTimeout(() => {
      if (data.role === "admin") {
        window.location.href = "admin.html";
      } else {
        window.location.href = "customer.html";
      }
    }, 800);
    
  } catch (error) {
    messageEl.innerText = error.message;
    messageEl.classList.add("text-danger");
  }
}

// Enter key support
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('password').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') authUser();
  });
});
</script>
</body>
</html>
